<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸš— iCar Cloud</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore-compat.js"></script>

<style>
body {
  font-family: "Segoe UI", Tahoma, Arial, sans-serif;
  background: linear-gradient(135deg, #e3f2fd, #bbdefb, #90caf9);
  color: #333; margin:0; padding:0; min-height:100vh;
}
header { background:#1976d2; color:white; text-align:center; padding:15px; font-size:24px; font-weight:bold; }
.container { max-width:800px; margin:20px auto; background:white; padding:20px; border-radius:12px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
h2{color:#1976d2;margin-top:20px;}
select,input[type="text"],button{display:block;width:100%;margin:10px 0;padding:8px;font-size:16px;}
select,input[type="text"]{border:1px solid #ccc;border-radius:6px;}
button{background:#1976d2;color:white;border:none;border-radius:6px;cursor:pointer;}
button:hover{background:#0d47a1;}
.checkbox-item{display:flex;align-items:center;justify-content:space-between;border:1px solid #ddd;padding:8px;border-radius:8px;margin:5px 0;transition:0.3s;}
.checkbox-item.checked{background:#c8e6c9;}
.checkbox-item input[type="text"]{width:150px;margin-left:10px;}
.vehicle-item{padding:8px;border:1px solid #ccc;margin:5px 0;border-radius:6px;cursor:pointer;}
.vehicle-item.active{background:#bbdefb;}
.delete-btn{color:red;font-weight:bold;margin-left:10px;cursor:pointer;}
footer{text-align:center;margin-top:20px;color:#666;}
</style>
</head>
<body>

<header>ğŸš— iCar Cloud</header>

<div class="container">
<button id="loginBtn">Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Google</button>
<div id="userInfo" style="display:none;">Î£Ï…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿Ï‚: <span id="userName"></span> <button id="logoutBtn">Î‘Ï€Î¿ÏƒÏÎ½Î´ÎµÏƒÎ·</button></div>

<h2>Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎŸÏ‡Î®Î¼Î±Ï„Î¿Ï‚</h2>
<label>ÎœÎ¬ÏÎºÎ±:</label>
<select id="brand"><option value="">--Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎœÎ¬ÏÎºÎ±--</option></select>
<label>ÎœÎ¿Î½Ï„Î­Î»Î¿:</label>
<select id="model"><option value="">--Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎœÎ¿Î½Ï„Î­Î»Î¿--</option></select>
<label>Î§ÏÎ¿Î½Î¿Î»Î¿Î³Î¯Î±:</label>
<input type="text" id="year" placeholder="Ï€.Ï‡. 2018">
<button id="saveVehicle">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÎŸÏ‡Î®Î¼Î±Ï„Î¿Ï‚</button>

<h2>Î‘Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½Î± ÎŸÏ‡Î®Î¼Î±Ï„Î±</h2>
<div id="vehicleList"></div>

<h2>Î£Î·Î¼ÎµÎ¯Î± Î•Î»Î­Î³Ï‡Î¿Ï…</h2>
<div id="serviceList"></div>
</div>

<footer>by MikeMigk</footer>

<script>
// ====== Firebase Config ======
// Î’Î¬Î»Îµ Ï„Î± Î´Î¹ÎºÎ¬ ÏƒÎ¿Ï… keys
const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "PROJECT_ID.firebaseapp.com",
  projectId: "PROJECT_ID",
  storageBucket: "PROJECT_ID.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ====== ÎœÎ¬ÏÎºÎµÏ‚ & ÎœÎ¿Î½Ï„Î­Î»Î± ======
const modelOptions = {
  Audi:["A3","A4","A6","Q2","Q3","Q5"],
  BMW:["1 Series","3 Series","5 Series","X1","X3"],
  Mercedes:["A-Class","C-Class","E-Class","GLA","GLC"],
  Smart:["Fortwo","Forfour","Roadster","Fortwo Cabrio","EQ Fortwo","EQ Forfour"],
  Toyota:["Yaris","Corolla","Aygo","C-HR"],
  Peugeot:["208","308","3008","2008"],
  Honda:["Civic","Jazz","CR-V"],
  Kawasaki:["Ninja","Z650","Versys"],
  Yamaha:["MT-07","R1","XSR700"]
};
const serviceItems = [
"Î‘Î»Î»Î±Î³Î® Î»Î±Î´Î¹ÏÎ½","Î¦Î¯Î»Ï„ÏÎ¿ Î»Î±Î´Î¹Î¿Ï","Î¦Î¯Î»Ï„ÏÎ¿ Î±Î­ÏÎ±","Î¦Î¯Î»Ï„ÏÎ¿ ÎºÎ±Î¼Ï€Î¯Î½Î±Ï‚","Î¦Î¯Î»Ï„ÏÎ¿ Î²ÎµÎ½Î¶Î¯Î½Î·Ï‚",
"Î¥Î³ÏÎ¬ Ï†ÏÎ­Î½Ï‰Î½","Î¤Î±ÎºÎ¬ÎºÎ¹Î±","Î”Î¯ÏƒÎºÎ¿Î¹ Ï†ÏÎ­Î½Ï‰Î½","Î•Î»Î±ÏƒÏ„Î¹ÎºÎ¬","Î Î¯ÎµÏƒÎ· Î±Î­ÏÎ± ÎµÎ»Î±ÏƒÏ„Î¹ÎºÏÎ½","Î‘Î»Î»Î±Î³Î® ÎµÎ»Î±ÏƒÏ„Î¹ÎºÏÎ½",
"ÎœÏ€Î±Ï„Î±ÏÎ¯Î±","Î¥Î±Î»Î¿ÎºÎ±Î¸Î±ÏÎ¹ÏƒÏ„Î®ÏÎµÏ‚","Î¨Ï…ÎºÏ„Î¹ÎºÏŒ Ï…Î³ÏÏŒ","Î™Î¼Î¬Î½Ï„Î±Ï‚ Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼Î¿Ï","Î¦ÏÏ„Î±",
"Î£Ï„Î¬Î¸Î¼Î· Î»Î±Î´Î¹Î¿Ï","ÎšÎ»Î¹Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒÏ‚","Î£ÏÏƒÏ„Î·Î¼Î± Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·Ï‚","Î‘Î¼Î¿ÏÏ„Î¹ÏƒÎ­Ï","Î•Î¾Î¬Ï„Î¼Î¹ÏƒÎ·","Î‘Î½Î¬ÏÏ„Î·ÏƒÎ·",
"Î”Î¹Î±ÏÏÎ¿Î­Ï‚ Î»Î±Î´Î¹Î¿Ï","Î£ÏÏƒÏ„Î·Î¼Î± Ï€Î­Î´Î·ÏƒÎ·Ï‚","ÎšÎ¤Î•ÎŸ","Î‘ÏƒÏ†Î¬Î»ÎµÎ¹Î±"
];

// ====== DOM Elements ======
const brandSelect = document.getElementById("brand");
const modelSelect = document.getElementById("model");
const serviceListDiv = document.getElementById("serviceList");
const vehicleListDiv = document.getElementById("vehicleList");
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const userInfoDiv = document.getElementById("userInfo");
const userNameSpan = document.getElementById("userName");

// ====== Populate brands ======
Object.keys(modelOptions).forEach(brand=>{
  const opt = document.createElement("option"); opt.value=brand; opt.textContent=brand; brandSelect.appendChild(opt);
});

// ====== Update models ======
brandSelect.addEventListener("change",()=>{
  const models = modelOptions[brandSelect.value] || [];
  modelSelect.innerHTML = "<option value=''>--Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎœÎ¿Î½Ï„Î­Î»Î¿--</option>";
  models.forEach(m=>{
    const opt=document.createElement("option"); opt.value=m; opt.textContent=m; modelSelect.appendChild(opt);
  });
});

// ====== Load service checkboxes ======
function loadService(){
  serviceListDiv.innerHTML="";
  serviceItems.forEach(item=>{
    const div=document.createElement("div");
    div.className="checkbox-item";
    div.innerHTML=`<label><input type="checkbox"> ${item}</label><input type="text" placeholder="Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±/Î£Ï‡ÏŒÎ»Î¹Î¿">`;
    serviceListDiv.appendChild(div);
  });
}
loadService();

// ====== Login/Logout ======
loginBtn.onclick = ()=>{
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
};
logoutBtn.onclick = ()=> auth.signOut();

// ====== Auth state ======
let currentUser=null;
auth.onAuthStateChanged(user=>{
  if(user){
    currentUser = user;
    loginBtn.style.display="none";
    userInfoDiv.style.display="block";
    userNameSpan.textContent=user.displayName;
    loadUserVehicles();
  } else {
    currentUser=null;
    loginBtn.style.display="block";
    userInfoDiv.style.display="none";
    vehicleListDiv.innerHTML="";
    serviceListDiv.innerHTML="";
  }
});

// ====== Save vehicle ======
document.getElementById("saveVehicle").addEventListener("click",()=>{
  if(!currentUser){alert("Î£ÏÎ½Î´ÎµÏƒÎ· Î±Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹!"); return;}
  const brand = brandSelect.value;
  const model = modelSelect.value;
  const year = document.getElementById("year").value.trim();
  if(!brand||!model||!year){alert("Î£Ï…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ ÏŒÎ»Î± Ï„Î± Ï€ÎµÎ´Î¯Î±!");return;}
  const key = `${brand} ${model} ${year}`;
  const services = getCurrentServiceData();
  db.collection("users").doc(currentUser.uid).collection("vehicles").doc(key).set({brand,model,year,services})
  .then(()=>loadUserVehicles());
});

// ====== Get current service data ======
function getCurrentServiceData(){
  const data=[];
  document.querySelectorAll(".checkbox-item").forEach(item=>{
    const cb=item.querySelector("input[type='checkbox']");
    const note=item.querySelector("input[type='text']").value;
    data.push({name:item.innerText.trim(),checked:cb.checked,note});
  });
  return data;
}

// ====== Load user's vehicles ======
function loadUserVehicles(){
  vehicleListDiv.innerHTML="";
  if(!currentUser) return;
  db.collection("users").doc(currentUser.uid).collection("vehicles").get()
  .then(snapshot=>{
    snapshot.forEach(doc=>{
      const v=doc.data();
      const div=document.createElement("div");
      div.className="vehicle-item"; div.dataset.key=doc.id;
      div.textContent=`${v.brand} ${v.model} (${v.year})`;
      const del=document.createElement("span"); del.textContent="âœ–"; del.className="delete-btn";
      del.onclick=(e)=>{
        e.stopPropagation();
        if(confirm("Î˜Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Ï„Î¿ ÏŒÏ‡Î·Î¼Î±;")){
          db.collection("users").doc(currentUser.uid).collection("vehicles").doc(doc.id).delete()
          .then(()=>loadUserVehicles());
        }
      };
      div.appendChild(del);
      div.onclick=()=> loadVehicleData(v,doc.id);
      vehicleListDiv.appendChild(div);
    });
    const first = vehicleListDiv.querySelector(".vehicle-item");
    if(first) first.click();
  });
}

// ====== Load vehicle data to form ======
function loadVehicleData(vehicle,key){
  document.getElementById("brand").value=vehicle.brand; brandSelect.dispatchEvent(new Event("change"));
  document.getElementById("model").value=vehicle.model;
  document.getElementById("year").value=vehicle.year;
  document.querySelectorAll(".vehicle-item").forEach(el=>el.classList.remove("active"));
  vehicleListDiv.querySelector(`[data-key="${key}"]`).classList.add("active");
  document.querySelectorAll(".checkbox-item").forEach((item,i)=>{
    const cb=item.querySelector("input[type='checkbox']");
    const note=item.querySelector("input[type='text']");
    if(vehicle.services[i]){
      cb.checked=vehicle.services[i].checked;
      note.value=vehicle.services[i].note;
      item.classList.toggle("checked",cb.checked);
    } else {cb.checked=false; note.value=""; item.classList.remove("checked");}
  });
}

// ====== Checkbox toggle ======
serviceListDiv.addEventListener("change",e=>{
  if(e.target.type==="checkbox") toggleService(e.target);
});

function toggleService(cb){
  const parent=cb.closest(".checkbox-item");
  parent.classList.toggle("checked",cb.checked);
  saveCurrentVehicleService();
}

function saveCurrentVehicleService(){
  const active = vehicleListDiv.querySelector(".vehicle-item.active");
  if(!active) return;
  const key = active.dataset.key;
  const brand=document.getElementById("brand").value;
  const model=document.getElementById("model").value;
  const year=document.getElementById("year").value.trim();
  const services=getCurrentServiceData();
  db.collection("users").doc(currentUser.uid).collection("vehicles").doc(key).set({brand,model,year,services})
}
</script>

</body>
</html>